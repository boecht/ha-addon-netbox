#include <tunables/global>

profile ha-addon-netbox flags=(attach_disconnected,mediate_deleted) {
  #include <abstractions/base>
  #include <abstractions/bash>
  #include <abstractions/nameservice>
  #include <abstractions/openssl>
  #include <abstractions/python>

  capability chown,
  capability dac_override,
  capability dac_read_search,
  capability fowner,
  capability setgid,
  capability setuid,
  capability sys_resource,

  network inet,
  network inet6,

  /bin/**              mrix,
  /usr/bin/**          mrix,
  /usr/sbin/**         mrix,
  /usr/lib/**          mrix,
  /usr/share/**        mr,
  /opt/**              mrwix,
  /data/**             mrwlkix,
  /run/**              mrwlkix,
  /tmp/**              mrwlkix,
  /etc/netbox/**       mrwlkix,
  /var/log/**          mrwlkix,
  /proc/*              r,
  @{HOME}/**           mrwlkix,

  /usr/local/bin/addon-run.sh       mrix,
  /usr/bin/gosu                     mrix,
  /usr/bin/redis-server             mrix,
  /usr/bin/redis-cli                mrix,
  /usr/lib/postgresql/**            mrix,

  deny /sys/firmware/efi/efivars/** rwk,
}
